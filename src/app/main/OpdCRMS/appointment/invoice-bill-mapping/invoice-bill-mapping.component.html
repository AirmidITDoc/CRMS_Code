<div fxFlexFill fxLayout="row" fxLayout.gt-xs="column" fxLayoutGap="10px" style="width: 100%; background:#F5F5F5; ">
    <!-- <div class="col-md-12" style="padding:10px;" *ngIf="selectedView == 'Dropdown'"> -->
    <div class="container" style="width: 100%;">
        <div style="width: 100%;">
            <!-- <div fxFlex> -->
            <div fxLayout="row" fxLayoutAlign="start center" class="accent"
                style="width:100% ; height:37px;color: white;">

                <div class="logo" fxLayout="row" fxLayoutAlign="start center" style="width: 100%;">

                    <span style="font-size: 22px; font-weight: 500; color: #fff;margin-left: 10px;">Invoice </span>

                    <div fxLayout="row" fxLayoutAlign="start center" style="float: right;margin-left: 1200px;">

                        <span class="material-icons" style="cursor: pointer;" (click)="onClose()">
                            close
                        </span>
                    </div>
                </div>
            </div>


            <div class="content-card"
                style="width:100%;  margin-top: 2px; float: right;background-color: white; margin-right: 10px;margin-left: 10px;">
                <mat-card-content style="width: 100%;margin-right: 5px;">

                    <div fxLayout="column">

                        <div>
                            <div fxFlexFill fxLayout="column" fxLayout.gt-xs="column" fxLayoutGap="3px">
                                <div fxlayout="row" style=" padding: 3px 3px 3px 1px; margin-right: 5px;">
                                    <!-- ================================ LABEL HEADER  -->

                                    <mat-card fxFlex.gt-sm="100%" fxFlex
                                        style="padding: 0 5px; height: fit-content; background-color: white;">
                                        &nbsp;
                                        <div style="float: right;">
                                            <!-- <span style="margin-right: 40px;color: black;font-weight: bold;">
                                        
                                    </span> -->
                                        </div>
                                        <form [formGroup]="registeredForm" style="display: flex;" #f="ngForm" #aForm>

                                            <div fxFlexFill fxLayout="row" fxLayoutAlign="space-between"
                                                fxLayoutGap="5px" style="margin-top: 20px;margin-left: 20px;">

                                                <mat-form-field appearance="outline" style="width: 20%;">
                                                    <mat-label>CaseId</mat-label>
                                                    <mat-select formControlName="CaseId" name="CaseId"
                                                        (selectionChange)="getCaseList()">
                                                        <mat-option></mat-option>
                                                        <mat-option *ngFor="let m of caseList" [value]="m">
                                                            {{m.StudyId}} || {{m.ProtocolNo}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>

                                                <app-common-date [screenFrom]="screenFromString"
                                                    (dateTimeEventEmitter)="getDateTime($event)"></app-common-date>
                                            </div>
                                        </form>
                                    </mat-card>

                                </div>
                            </div>
                        </div>

                        <div fxLayout="row" style="width: 100%;">


                            <div fxFlex="100" fxFlex.gt-sm="100" fxLayout="row" fxLayout.gt-xs="column"
                                style="width:90%; ;margin-left: 1px; margin-right: 5px; margin-top: 7px;margin-left: 7px;">


                                <ng-template mat-tab-label style="color: black; font-size: 17px bold; height: 100px; ">
                                    <!-- <mat-icon class="example-tab-icon">thumb_up</mat-icon>&nbsp; -->
                                    Bill list
                                </ng-template>
                                <div>
                                    <div class="col-md-12">
                                        <!-- ================= Charges List Table ======================= -->

                                        <mat-table #table matSort [dataSource]="dataSource"
                                            [@animateStagger]="{value:'50'}" class="table1"
                                            style="overflow: auto;width: 100%;">

                                            <!-- <ng-container matColumnDef="checkbox" sticky>
                                            <mat-header-cell *matHeaderCellDef mat-sort-header>
                                                <span class="material-icons" (click)="getCaseList()">
                                                    checkbox
                                                </span>
                                            </mat-header-cell>
                                            <mat-cell *matCellDef="let contact">
                                                <mat-checkbox aria-label="Checked"
                                                    (change)="tableElementChecked($event,contact)">
                                                </mat-checkbox>
                                            </mat-cell>
                                        </ng-container> -->

                                            <ng-container matColumnDef="BillNo" style="margin-left: 10px;">
                                                <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>BillNo
                                                </mat-header-cell>
                                                <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                                                    {{contact.BillNo}}
                                                </mat-cell>
                                            </ng-container>

                                            <!-- <ng-container matColumnDef="CaseId">
                                            <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>Case
                                                Id</mat-header-cell>
                                            <mat-cell *matCellDef="let contact" fxShow.gt-sm>
                                                {{contact.CaseId}}
                                            </mat-cell>
                                        </ng-container> -->


                                            <!-- <ng-container matColumnDef="CaseTitle">
                                            <mat-header-cell *matHeaderCellDef mat-sort-header fxShow.gt-sm>Case Title
                                            </mat-header-cell>
                                            <mat-cell *matCellDef="let contact" fxShow.gt-sm style="margin-top: 1px;">
                                                {{contact.CaseTitle}}
                                            </mat-cell>
                                        </ng-container> -->

                                            <ng-container matColumnDef="PatientName">
                                                <mat-header-cell *matHeaderCellDef mat-sort-header fxHide
                                                    fxShow.gt-md>Patient Name
                                                </mat-header-cell>
                                                <mat-cell *matCellDef="let contact" fxHide fxShow.gt-md>
                                                    {{contact.PatientName }}
                                                </mat-cell>
                                            </ng-container>

                                            <ng-container matColumnDef="RegNo">
                                                <mat-header-cell *matHeaderCellDef mat-sort-header fxHide
                                                    fxShow.gt-md>Reg
                                                    No
                                                </mat-header-cell>
                                                <mat-cell *matCellDef="let contact" fxHide fxShow.gt-md>
                                                    {{contact.RegNo}}
                                                </mat-cell>
                                            </ng-container>

                                            <!-- <ng-container matColumnDef="MobileNo">
                                            <mat-header-cell *matHeaderCellDef mat-sort-header fxHide
                                                fxShow.gt-md>Mobile No
                                            </mat-header-cell>
                                            <mat-cell *matCellDef="let contact" fxHide fxShow.gt-md>
                                                {{contact.MobileNo}}
                                            </mat-cell>
                                        </ng-container>

                                        <ng-container matColumnDef="AgeYear">
                                            <mat-header-cell *matHeaderCellDef mat-sort-header fxHide fxShow.gt-md>Age
                                                Year</mat-header-cell>
                                            <mat-cell *matCellDef="let contact" fxHide fxShow.gt-md
                                                style="margin-top: 1px;">
                                                {{contact.AgeYear}}
                                            </mat-cell>
                                        </ng-container> -->

                                            <ng-container matColumnDef="TotalBillAmt">
                                                <mat-header-cell *matHeaderCellDef mat-sort-header fxHide
                                                    fxShow.gt-md>TotalBillAmt</mat-header-cell>
                                                <mat-cell *matCellDef="let contact" fxHide fxShow.gt-md
                                                    style="margin-top: 1px;">
                                                    {{contact.TotalBillAmt}}
                                                </mat-cell>
                                            </ng-container>


                                            <ng-container matColumnDef="action" stickyEnd>
                                                <mat-header-cell *matHeaderCellDef style="color: white;"> Action
                                                </mat-header-cell>
                                                <mat-cell *matCellDef="let row">
                                                    <!-- <button mat-icon-button (click)="onEdit(row)"><mat-icon
                                                        title="Edit Menu">launch</mat-icon></button> -->
                                                    <button mat-icon-button (click)="deleteTableRow(row)" color="warn">
                                                        <mat-icon>delete_outline</mat-icon>
                                                    </button>
                                                </mat-cell>
                                            </ng-container>


                                            <ng-container matColumnDef="loading">
                                                <mat-header-cell *matFooterCellDef colspan="6" style="display: none;">
                                                </mat-header-cell>
                                            </ng-container>

                                            <ng-container matColumnDef="noData">
                                                <mat-footer-cell *matFooterCellDef colspan="6">
                                                    no data found...
                                                </mat-footer-cell>
                                            </ng-container>

                                            <mat-header-row class="accent"
                                                *matHeaderRowDef="displayedColumns; sticky: true">
                                            </mat-header-row>
                                            <mat-row *matRowDef="let contact; columns: displayedColumns;"
                                                class="contact" [@animate]="{value:'*',params:{y:'100%'}}"></mat-row>
                                            <mat-footer-row *matFooterRowDef="['loading']"
                                                [ngClass]="{'hide': !(sIsLoading == 'loading-data')}">
                                            </mat-footer-row>
                                            <mat-footer-row *matFooterRowDef="['noData']"
                                                [ngClass]="{'hide':!(dataSource!=null && dataSource.data.length==0)}"></mat-footer-row>
                                        </mat-table>
                                        <!-- ================= Charges List Footer Table ======================= -->
                                        <div>
                                            <mat-paginator [pageSizeOptions]="[10,20,30]" [pageSize]="10"
                                                showFirstLastButtons>
                                            </mat-paginator>
                                            <div class="net-amt" style="margin-left: 900px;" hidden="true">
                                                <span class="net-amt-label"
                                                    style="font-size: large;font-family: sans-serif;"></span>&nbsp;<span
                                                    class="net-amt-value">{{getNetAmtSum(dataSource.data)}}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>



                        </div>

                        <div class="content-card"
                            style="width:100%;  margin-top: 2px; float: right;background-color: white;height: 100%;">
                            <div fxFlexFill fxLayout="column" fxLayout.gt-xs="column" fxLayoutGap="3px">
                                <div fxlayout="row" style=" padding: 3px 3px 3px 1px; margin-right: 5px;">
                                    <!-- ================================ LABEL HEADER  -->

                                    <mat-card fxFlex.gt-sm="100%" fxFlex
                                        style="padding: 0 5px; height: fit-content; background-color: white;">
                                        &nbsp;
                                        <form [formGroup]="registeredForm" style="display: flex;" #f="ngForm" #aForm>

                                            <div fxFlexFill fxLayout="row" fxLayoutAlign="space-between"
                                                fxLayoutGap="5px">


                                                <mat-form-field appearance="outline" fxFlex>
                                                    <mat-label>TaxableAmount</mat-label>
                                                    <input matInput [(ngModel)]="TaxableAmount" name="TaxableAmount"
                                                        formControlName="TaxableAmount" required
                                                        style="font-weight: bold;">
                                                    <!-- <mat-error
                                                    *ngIf="registeredForm.get('totalAmount').invalid && registeredForm.get('totalAmount').touched">
                                                    TotalAmount is required</mat-error> -->
                                                </mat-form-field>



                                                <mat-form-field appearance="outline" style="width: 100px;">
                                                    <mat-label>CGST</mat-label>
                                                    <input matInput [(ngModel)]="CGST" name="CGST"
                                                        formControlName="CGST" type="number" (keyup)="calculateCGST()">
                                                    <!-- <mat-error
                                                    *ngIf="registeredForm.get('discAmount').invalid && registeredForm.get('discAmount').touched">
                                                    Discount Amount Schod me Less than Tptal Amount TotalAmount is
                                                    required</mat-error> -->
                                                </mat-form-field>


                                                <mat-form-field appearance="outline" style="width: 100px;">
                                                    <mat-label>CGST Amount</mat-label>
                                                    <input matInput [(ngModel)]="CGSTAmount" name="CGSTAmount"
                                                        formControlName="CGSTAmount" type="number" readonly>
                                                    <!-- <mat-error
                                                    *ngIf="registeredForm.get('discAmount').invalid && registeredForm.get('discAmount').touched">
                                                    Discount Amount Schod me Less than Tptal Amount TotalAmount is
                                                    required</mat-error> -->
                                                </mat-form-field>

                                                <mat-form-field appearance="outline" style="width: 100px;">
                                                    <mat-label>SGST</mat-label>
                                                    <input matInput [(ngModel)]="SGST" name="SGST"
                                                        formControlName="SGST" required (keyup)="calculateSGST()">
                                                    <!-- <mat-error
                                                    *ngIf="registeredForm.get('netAmount').invalid && registeredForm.get('netAmount').touched">
                                                    NetAmount is required</mat-error> -->
                                                </mat-form-field>


                                                <mat-form-field appearance="outline" style="width: 100px;">
                                                    <mat-label>SGST Amount</mat-label>
                                                    <input matInput [(ngModel)]="SGSTAmount" name="SGSTAmount"
                                                        formControlName="SGSTAmount" type="number" readonly>
                                                    <!-- <mat-error
                                                    *ngIf="registeredForm.get('discAmount').invalid && registeredForm.get('discAmount').touched">
                                                    Discount Amount Schod me Less than Tptal Amount TotalAmount is
                                                    required</mat-error> -->
                                                </mat-form-field>

                                                <mat-form-field appearance="outline" style="width:100px;">
                                                    <mat-label>IGST</mat-label>
                                                    <input matInput [(ngModel)]="IGST" name="IGST"
                                                        formControlName="IGST" required (keyup)="calculateIGST()">
                                                    <!-- <mat-error
                                                    *ngIf="registeredForm.get('netAmount').invalid && registeredForm.get('netAmount').touched">
                                                    NetAmount is required</mat-error> -->
                                                </mat-form-field>

                                                <mat-form-field appearance="outline" style="width: 100px;">
                                                    <mat-label>IGST Amount</mat-label>
                                                    <input matInput [(ngModel)]="IGSTAmount" name="IGSTAmount"
                                                        formControlName="IGSTAmount" type="number" readonly>
                                                    <!-- <mat-error
                                                    *ngIf="registeredForm.get('discAmount').invalid && registeredForm.get('discAmount').touched">
                                                    Discount Amount Schod me Less than Tptal Amount TotalAmount is
                                                    required</mat-error> -->
                                                </mat-form-field>


                                                <mat-form-field appearance="outline" fxFlex>
                                                    <mat-label>TotalAmount</mat-label>
                                                    <input matInput [(ngModel)]="FinalTotalAmount" name="TotalAmount"
                                                        formControlName="TotalAmount" style="font-weight: bold;"
                                                        required>
                                                    <!-- <mat-error
                                                    *ngIf="registeredForm.get('price').invalid && registeredForm.get('price').touched">
                                                    Price is required</mat-error> -->
                                                </mat-form-field>

                                            </div>
                                        </form>
                                    </mat-card>

                                </div>
                            </div>

                            <div style="float: right;margin-top: 20px;">
                                <button class="next-btn" color="accent" (click)="onSaveOPBill()">
                                    <span style="display: flex;justify-content: center;">
                                        <span>Save</span>
                                    </span>
                                </button>
        
                                <button class="footer-btn" (click)="onClose()">Cancel</button>
                            </div>
                        </div>


                    </div>


                  
                </mat-card-content>
            </div>